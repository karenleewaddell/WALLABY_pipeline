{
    "$schema": "http://json-schema.org/draft-07/schema",
    "$id": "https://github.com/AusSRC/WALLABY_workflows/master/nextflow_schema.json",
    "title": "WALLABY source finding pipeline",
    "description": "Execution of the source finding component of the WALLABY nextflow pipeline. Takes a mosaicked image cube that is sitting in the local file system, runs sofia for source detection and sofiax to write detections to a PostgreSQL database.",
    "type": "object",
    "definitions": {
        "environment": {
            "title": "Environment",
            "type": "object",
            "description": "Environment details for the execution of the WALLABY workflow in the AusSRC shared file system.",
            "default": "",
            "properties": {
                "IMAGE_CUBE": {
                    "type": "string",
                    "description": "Filename and path to mosaicked image cube."
                },
                "WORKDIR": {
                    "type": "string",
                    "description": "Working directory in the shared file system to save all WALLABY workflow files",
                    "default": "/mnt/shared/home/ashen/outputs/tmp"
                }
            },
            "required": [
                "IMAGE_CUBE",
                "WORKDIR"
            ]
        },
        "sofia": {
            "title": "SoFiA",
            "type": "object",
            "description": "Information for the SoFiA run.",
            "default": "",
            "properties": {
                "SOFIA_RUN_NAME": {
                    "type": "string",
                    "description": "Name for this run of the WALLABY workflow",
                    "default": "sofia"
                },
                "SOFIA_PARAMS_FILE": {
                    "type": "string",
                    "description": "Filename for the generated sofia parameter file",
                    "default": "sofia.par"
                }
            },
            "required": [
                "SOFIA_RUN_NAME"
            ]
        },
        "sofiax": {
            "title": "SoFiAX",
            "type": "object",
            "description": "Parameters required for the execution of SoFiAX",
            "default": "",
            "properties": {
                "SOFIAX_CONFIG_FILE": {
                    "type": "string",
                    "description": "Filename and path for the automatically generated sofiax configuration file",
                    "default": "config.ini"
                },
                "DATABASE_HOST": {
                    "type": "string",
                    "description": "Hostname of the database to write SoFiA outputs"
                },
                "DATABASE_NAME": {
                    "type": "string",
                    "description": "Name of the database to write SoFiA outputs",
                    "default": "sofiadb"
                },
                "DATABASE_USER": {
                    "type": "string",
                    "description": "Username for database access"
                },
                "DATABASE_PASS": {
                    "type": "string",
                    "description": "Password for database access"
                }
            },
            "required": [
                "SOFIAX_CONFIG_FILE",
                "DATABASE_HOST",
                "DATABASE_NAME",
                "DATABASE_USER",
                "DATABASE_PASS"
            ]
        },
        "docker": {
            "title": "Docker",
            "type": "object",
            "description": "Docker images to use for pipeline execution.",
            "default": "",
            "properties": {
                "WALLABY_COMPONENTS_IMAGE": {
                    "type": "string",
                    "description": "Docker image for component functions of the WALLABY workflow.",
                    "default": "aussrc/wallaby_scripts:v0.1.0"
                },
                "S2P_IMAGE": {
                    "type": "string",
                    "description": "Docker image for generation of sofia parameter and sofiax config files using s2p_setup.py.",
                    "default": "aussrc/s2p_setup:latest"
                },
                "SOFIA_IMAGE": {
                    "type": "string",
                    "description": "Docker image for the execution of sofia.",
                    "default": "astroaustin/sofiax:v0.0.6"
                },
                "SOFIAX_IMAGE": {
                    "type": "string",
                    "description": "Docker image for the execution of sofiax.",
                    "default": "aussrc/sofiax:v0.1.1"
                }
            },
            "required": [
                "WALLABY_COMPONENTS_IMAGE",
                "S2P_IMAGE",
                "SOFIAX_IMAGE",
                "SOFIA_IMAGE"
            ]
        },
        "sofia_parameters": {
            "title": "Sofia parameters",
            "type": "object",
            "description": "Optional parameters for the execution of SoFiA.",
            "properties": {
                "SOFIA_PIPELINE_VERBOSE": {
                    "type": "string",
                    "default": "false"
                },
                "SOFIA_PIPELINE_PEDANTIC": {
                    "type": "string",
                    "default": "true"
                },
                "SOFIA_PIPELINE_THREADS": {
                    "type": "string",
                    "default": "0"
                },
                "SOFIA_INPUT_GAIN": {
                    "type": "string",
                    "default": ""
                },
                "SOFIA_INPUT_NOISE": {
                    "type": "string",
                    "default": ""
                },
                "SOFIA_INPUT_WEIGHTS": {
                    "type": "string",
                    "default": ""
                },
                "SOFIA_INPUT_MASK": {
                    "type": "string",
                    "default": ""
                },
                "SOFIA_INPUT_INVERT": {
                    "type": "string",
                    "default": "false"
                },
                "SOFIA_FLAG_REGION": {
                    "type": "string",
                    "default": ""
                },
                "SOFIA_FLAG_CATALOG": {
                    "type": "string",
                    "default": ""
                },
                "SOFIA_FLAG_RADIUS": {
                    "type": "string",
                    "default": "5"
                },
                "SOFIA_FLAG_AUTO": {
                    "type": "string",
                    "default": "true"
                },
                "SOFIA_FLAG_THRESHOLD": {
                    "type": "string",
                    "default": "5.0"
                },
                "SOFIA_FLAG_LOG": {
                    "type": "string",
                    "default": "true"
                },
                "SOFIA_SCALENOISE_ENABLE": {
                    "type": "string",
                    "default": "true"
                },
                "SOFIA_SCALENOISE_MODE": {
                    "type": "string",
                    "default": "local"
                },
                "SOFIA_SCALENOISE_WINDOWXY": {
                    "type": "string",
                    "default": "51"
                },
                "SOFIA_SCALENOISE_WINDOWZ": {
                    "type": "string",
                    "default": "51"
                },
                "SOFIA_SCALENOISE_GRIDXY": {
                    "type": "string",
                    "default": "0"
                },
                "SOFIA_SCALENOISE_GRIDZ": {
                    "type": "string",
                    "default": "0"
                },
                "SOFIA_SCALENOISE_INTERPOLATE": {
                    "type": "string",
                    "default": "true"
                },
                "SOFIA_SCALENOISE_SCFIND": {
                    "type": "string",
                    "default": "false"
                },
                "SOFIA_SCFIND_ENABLE": {
                    "type": "string",
                    "default": "true"
                },
                "SOFIA_SCFIND_KERNELSXY": {
                    "type": "string",
                    "default": "0, 5, 10"
                },
                "SOFIA_SCFIND_KERNELSZ": {
                    "type": "string",
                    "default": "0, 3, 7, 15, 31"
                },
                "SOFIA_SCFIND_THRESHOLD": {
                    "type": "string",
                    "default": "3.8"
                },
                "SOFIA_SCFIND_REPLACEMENT": {
                    "type": "string",
                    "default": "2.0"
                },
                "SOFIA_SCFIND_STATISTIC": {
                    "type": "string",
                    "default": "mad"
                },
                "SOFIA_SCFIND_FLUXRANGE": {
                    "type": "string",
                    "default": "negative"
                },
                "SOFIA_THRESHOLD_ENABLE": {
                    "type": "string",
                    "default": "false"
                },
                "SOFIA_THRESHOLD_THRESHOLD": {
                    "type": "string",
                    "default": "5.0"
                },
                "SOFIA_THRESHOLD_MODE": {
                    "type": "string",
                    "default": "relative"
                },
                "SOFIA_THRESHOLD_STATISTIC": {
                    "type": "string",
                    "default": "mad"
                },
                "SOFIA_THRESHOLD_FLUXRANGE": {
                    "type": "string",
                    "default": "negative"
                },
                "SOFIA_LINKER_RADIUSXY": {
                    "type": "string",
                    "default": "2"
                },
                "SOFIA_LINKER_RADIUSZ": {
                    "type": "string",
                    "default": "2"
                },
                "SOFIA_LINKER_MINSIZEXY": {
                    "type": "string",
                    "default": "8"
                },
                "SOFIA_LINKER_MINSIZEZ": {
                    "type": "string",
                    "default": "5"
                },
                "SOFIA_LINKER_MAXSIZEXY": {
                    "type": "string",
                    "default": "0"
                },
                "SOFIA_LINKER_MAXSIZEZ": {
                    "type": "string",
                    "default": "0"
                },
                "SOFIA_LINKER_KEEPNEGATIVE": {
                    "type": "string",
                    "default": "false"
                },
                "SOFIA_RELIABILITY_ENABLE": {
                    "type": "string",
                    "default": "true"
                },
                "SOFIA_RELIABILITY_THRESHOLD": {
                    "type": "string",
                    "default": "0.8"
                },
                "SOFIA_RELIABILITY_SCALEKERNEL": {
                    "type": "string",
                    "default": "0.4"
                },
                "SOFIA_RELIABILITY_MINSNR": {
                    "type": "string",
                    "default": "3.0"
                },
                "SOFIA_RELIABILITY_PLOT": {
                    "type": "string",
                    "default": "true"
                },
                "SOFIA_PARAMETER_ENABLE": {
                    "type": "string",
                    "default": "true"
                },
                "SOFIA_PARAMETER_WCS": {
                    "type": "string",
                    "default": "true"
                },
                "SOFIA_PARAMETER_PHYSICAL": {
                    "type": "string",
                    "default": "true"
                },
                "SOFIA_PARAMETER_PREFIX": {
                    "type": "string",
                    "default": "WALLABY"
                },
                "SOFIA_PARAMETER_OFFSET": {
                    "type": "string",
                    "default": "false"
                },
                "SOFIA_OUTPUT_FILENAME": {
                    "type": "string",
                    "default": "sofia_output"
                },
                "SOFIA_OUTPUT_WRITECATASCII": {
                    "type": "string",
                    "default": "true"
                },
                "SOFIA_OUTPUT_WRITECATXML": {
                    "type": "string",
                    "default": "true"
                },
                "SOFIA_OUTPUT_WRITECATSQL": {
                    "type": "string",
                    "default": "true"
                },
                "SOFIA_OUTPUT_WRITENOISE": {
                    "type": "string",
                    "default": "false"
                },
                "SOFIA_OUTPUT_WRITEFILTERED": {
                    "type": "string",
                    "default": "false"
                },
                "SOFIA_OUTPUT_WRITEMASK": {
                    "type": "string",
                    "default": "false"
                },
                "SOFIA_OUTPUT_WRITEMASK2D": {
                    "type": "string",
                    "default": "true"
                },
                "SOFIA_OUTPUT_WRITERAWMASK": {
                    "type": "string",
                    "default": "false"
                },
                "SOFIA_OUTPUT_WRITEMOMENTS": {
                    "type": "string",
                    "default": "true"
                },
                "SOFIA_OUTPUT_WRITECUBELETS": {
                    "type": "string",
                    "default": "true"
                },
                "SOFIA_OUTPUT_MARGINCUBELETS": {
                    "type": "string",
                    "default": "10"
                },
                "SOFIA_OUTPUT_OVERWRITE": {
                    "type": "string",
                    "default": "true"
                }   
            }
        }
    },
    "allOf": [
        {
            "$ref": "#/definitions/environment"
        },
        {
            "$ref": "#/definitions/sofia"
        },
        {
            "$ref": "#/definitions/sofiax"
        },
        {
            "$ref": "#/definitions/docker"
        },
        {
            "$ref": "#/definitions/sofia_parameters"
        }
    ]
}